@using AnsibeProject.Models;
@model List<Professor>;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
<section class="courses">
    <h1 class="heading">Professors</h1>
    <div class="container">
        <form method="post" asp-controller="Professor" asp-action="Import" enctype="multipart/form-data">
            <input type="file" name="file" />
            <button type="submit" asp-controller="Professor" asp-action="Import">Import from Excel</button>
        </form>
    </div>
    <div class="box-container">
        <div class="box">
            <h3>Active Professors</h3>
            <a asp-controller="Professor" asp-action="Add" class="inline-btn">add Professor</a>

            <table class="table table-striped" >
                <thead>
                    <tr>
                        <th data-searchable="true">File Number</th>
                        <th data-searchable="true">Full Name In Arabic</th>
                        <th data-searchable="true">Speciality</th>
                        <th data-searchable="true">Rank</th>
                        <th data-searchable="true">Email</th>
                        <th data-searchable="true">Phone Number</th>
                        <th data-searchable="true">Contract Type</th>
                        @* <th data-searchable="true">Max Hours</th>
                        <th data-searchable="true">Min Hours</th> *@
                        <th data-searchable="true">Full Name</th>
                        <th data-searchable="true">Date Of Birth</th>
                        <th data-searchable="true">Edit</th>
                        <th data-searchable="true">Deactivate</th>
                        <th data-searchable="true">Delete</th>
                    </tr>
                </thead>
                <tbody id="Active">
                @if (Model != null && Model.Count() > 0)
                    {
   
      
                        @foreach (var professor in Model)
                        {
                            if (professor.ActiveState.Equals(ActiveState.Active))
                            {



                                <tr>
                                    <td>
                                        @professor.FileNumber
                                    </td>
                                    <td>@professor.FullNameInArabic</td>
                                    <td>
                                        @professor.Speciality
                                    </td>
                                    <td>
                                        @professor.Rank
                                    </td>
                                    <td>
                                        @professor.Email
                                    </td>
                                    <td>
                                        @professor.PhoneNumber
                                    </td>
                                    <td>
                                        @professor.Contract.ContractType
                                    </td>

                                    @* <td>
                                        @professor.Contract.MaxHours
                                    </td>
                                    <td>
                                        @professor.Contract.MinHours
                                    </td> *@
                                    <td>
                                        @professor.FirstName @professor.MiddleName @professor.LastName
                                    </td>
                                    <td>
                                        @professor.DateOfBirth
                                    </td>
                                    
                                    <td>
                                        <a asp-controller="Professor" asp-action="Edit" asp-route-FileNumber="@professor.FileNumber" class="inline-btn">edit</a>
                                    </td>
                                    <td>
                                        <button class="inline-btn" id="toggle-btn" onclick="toggleState(@professor.FileNumber,this)">Deactivate</button>
                                    </td>
                                    <td>
                                        <a class="inline-delete-btn" onclick="confirmDelete('@professor.FileNumber')">delete</a>
                                    </td>
                                </tr>

                            }

                        }

                        }


                    </tbody>
                </table>
            </div>
            <div class="box unactive">
                <h3>Inactive Professors</h3>
                <table class="table table-striped" >
                    <thead>
                        <tr>
                            <th data-searchable="true">File Number</th>
                            <th data-searchable="true">Full Name In Arabic</th>
                            <th data-searchable="true">Speciality</th>
                            <th data-searchable="true">Rank</th>
                            <th data-searchable="true">Email</th>
                            <th data-searchable="true">Phone Number</th>
                        <th data-searchable="true">Contract Type</th>
                        @* <th data-searchable="true">Max Hours</th>
                        <th data-searchable="true">Min Hours</th> *@
                        <th data-searchable="true">Full Name</th>
                            <th data-searchable="true">Date Of Birth</th>
                            <th data-searchable="true">Edit</th>
                            <th data-searchable="true">Deactivate</th>
                            <th data-searchable="true">Delete</th>
                        </tr>
                    </thead>
                <tbody id="Inactive">
                        @foreach (var professor in Model)
                        {
                            if (professor.ActiveState.Equals(ActiveState.NotActive))
                            {



                                <tr>
                                    <td>
                                        @professor.FileNumber
                                    </td>
                                    <td>@professor.FullNameInArabic</td>
                                    <td>
                                        @professor.Speciality
                                    </td>
                                    <td>
                                        @professor.Rank
                                    </td>
                                    <td>
                                        @professor.Email
                                    </td>
                                    <td>
                                        @professor.PhoneNumber
                                    </td>
                                <td>
                                    @professor.Contract.ContractType
                                </td>

                                @* <td>
                                    @professor.Contract.MaxHours
                                </td>
                                <td>
                                    @professor.Contract.MinHours
                                </td> *@
                                <td>
                                    @professor.FirstName @professor.MiddleName @professor.LastName
                                </td>
                                    <td>
                                        @professor.DateOfBirth
                                    </td>
                                    <td>
                                        <a asp-controller="Professor" asp-action="Edit" asp-route-FileNumber="@professor.FileNumber" class="inline-btn">edit</a>
                                    </td>
                                    <td>
                                        <button class="inline-btn" id="toggle-btn" onclick="toggleState(@professor.FileNumber,this)">Activate</button>
                                    </td>
                                    <td>
                                        <a class="inline-delete-btn" onclick="confirmDelete('@professor.FileNumber')">delete</a>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>


            </div>
        </div>
   
    @section Scripts {
    <script>
        $(document).ready(function () {
                $('.table').DataTable({
                    // Define language settings
                    language: {
                        // Customize the text for when the table is empty
                        emptyTable: "",
                        zeroRecords: ""
                    }
                });
        });
            function toggleState(FileNumber, button) {
                console.log(FileNumber);
                var requestParameter = {
                    fileNumber: FileNumber
                }
                $.ajax({
                    url: '@Url.Action("ChangeProfessorState", "Professor")',
                    type: 'POST',
                    data: requestParameter,
                    dataType: 'json',
                    success: function (data) {
                        if (data.success) {
                            var rowToMove = button.parentNode.parentNode;

                            var sourceTable = rowToMove.parentNode;
                            console.log(rowToMove)
                            
                            var targetTable = (data.target == "Active") ? document.getElementById("Active") : document.getElementById("Inactive");
                         
                            sourceTable.removeChild(rowToMove);
                            targetTable.appendChild(rowToMove);
                            button.textContent = (data.target == "Active") ? "Deactivate" : "Activate";

                        }
                        else {
                            console.error(data.errorMessage);
                        }
                    },
                    error: function (xhr, status, error) {
                        cosole.error(xhr.responseJSON.errorMessage);
                    }
                })
            }
        function confirmDelete(fileNumber) {
            Swal.fire({
                title: "Are you sure you want to delete this professor?",
                text: "This action cannot be undone. you can Deactivate",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                if (result.isConfirmed) {
                    // If user confirms, perform the delete action
                    window.location.href = "Professor/Delete?FileNumber=" + fileNumber;
                } else {
                    // If user cancels, show an informational message
                    Swal.fire("Deletion cancelled", "", "info");
                }
            });
        }
    </script>
    }
    
</section>